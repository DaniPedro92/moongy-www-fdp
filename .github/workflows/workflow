name: Request input information

# Controls when the workflow will run
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
    inputs:
      mensagem:
        type: string
        description: Coloque aqui a mensagem
        required: true
      sql-command:
        type: string
        description: Coloque aqui SQL a ser executado
        required: true
      ambiente:
        type: environment
      nuvem:
        type: choice
        description: Escolha o SGBD para deploy
        options:
          - SqlServer
          - Oracle
          - Postgres
          - MariaDB
      agreement:
        type: boolean
        description: Concorda com os termos
        required: true

  workflow_call:
    inputs:
      config-path:
        required: true
        type: string
      repo-token:
        required: true
        type: string
    secrets:
      SSH_SECRET_KEY:
        required: true

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  teste-postgres-sql:
    if: ${{ github.event.inputs.nuvem == 'Postgres' }} 
    uses: ./.github/workflows/postgres.yml
    with:
      config-path: "Postgres"
      repo-token: ${{ github.event.inputs.repo-token }}
    secrets:
      SSH_SECRET_KEY: ${{ secrets.SSH_SECRET_KEY }}

  teste-oracle-sql:
    if: ${{ github.event.inputs.nuvem == 'Oracle' }} 
    uses: ./.github/workflows/oracle.yml
    with:
      config-path: "Oracle"
      repo-token: ${{ github.event.inputs.repo-token }}
    secrets:
      SSH_SECRET_KEY: ${{ secrets.SSH_SECRET_KEY }}

  run-sql:
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{ github.event.inputs['config-path'] }}
      - run: echo ${{ github.event.inputs['sql-command'] }}
      - run: echo ${{ secrets.SSH_SECRET_KEY }}
